<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ジャンプ付きWASDゲーム</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }
    #gameArea {
      position: relative;
      width: 800px;
      height: 600px;
      margin: 30px auto;
      background: #444;
      border: 3px solid #fff;
      user-select: none;
    }
    #player {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #0f0;
      top: 560px; /* 初期は地面にいる想定 */
      left: 380px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="player"></div>
  </div>

  <script>
    const player = document.getElementById("player");
    const gameArea = document.getElementById("gameArea");
    const speed = 5;       // 横移動速度
    const gravity = 0.7;   // 重力加速度
    const jumpPower = 15;  // ジャンプ初速

    // キー状態
    const keys = { w: false, a: false, s: false, d: false };

    // 位置・速度
    let posX = parseInt(player.style.left);
    let posY = parseInt(player.style.top);
    let velocityY = 0; // 垂直方向の速度

    // 地面の高さ（playerのbottomがgameAreaのbottomに接する位置）
    const groundY = gameArea.clientHeight - player.clientHeight;

    window.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();
      if (keys.hasOwnProperty(key)) {
        keys[key] = true;
      }
    });

    window.addEventListener("keyup", (e) => {
      const key = e.key.toLowerCase();
      if (keys.hasOwnProperty(key)) {
        keys[key] = false;
      }
    });

    function update() {
      // 横移動
      if (keys.a) posX -= speed;
      if (keys.d) posX += speed;

      // ジャンプ（地面にいる時だけ）
      if (keys.w && posY >= groundY) {
        velocityY = -jumpPower;
      }

      // 重力加算
      velocityY += gravity;
      posY += velocityY;

      // 地面判定
      if (posY > groundY) {
        posY = groundY;
        velocityY = 0;
      }

      // 壁判定
      posX = Math.min(Math.max(posX, 0), gameArea.clientWidth - player.clientWidth);

      // 位置反映
      player.style.left = posX + "px";
      player.style.top = posY + "px";

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>
</html>
